<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stress Test FileWriter</title>
</head>
<body>
<h1>Stress Test: Membuat Banyak File Besar</h1>
<button id="startBtn">Mulai Stress Test</button>
<pre id="log"></pre>

<script>
function log(msg) {
    const pre = document.getElementById('log');
    pre.textContent += msg + "\n";
    console.log(msg);
}

function writeLargeFile(fs, name, sizeMB) {
    return new Promise((resolve, reject) => {
        fs.root.getFile(name, {create: true}, fileEntry => {
            fileEntry.createWriter(fileWriter => {
                const blob = new Blob([new Uint8Array(sizeMB * 1024 * 1024)]);
                fileWriter.onwriteend = () => {
                    log('File dibuat: ' + name);
                    resolve();
                };
                fileWriter.onerror = reject;
                fileWriter.write(blob);
            }, reject);
        }, reject);
    });
}

document.getElementById('startBtn').addEventListener('click', () => {
    window.webkitRequestFileSystem(window.TEMPORARY, 1024*1024*1024, async fs => {
        const files = [];
        for (let i = 0; i < 50; i++) { // 50 file
            files.push(writeLargeFile(fs, 'stressfile_' + i + '.bin', 200)); // 200 MB per file
        }

        try {
            await Promise.all(files);
            log('Semua file stress dibuat tanpa error');
        } catch(e) {
            log('Error saat stress test: ' + e);
        }
    }, err => log('Error requestFileSystem: ' + err));
});
</script>
</body>
</html>
